# vim: filetype=sh

# Test if $1 is available
isavailable() {
    type "$1" &>/dev/null
}

# NetworkManager ("Wifi icon")
isavailable nm-applet && nm-applet &

# Compositor
isavailable picom && picom -b

# This hides the mouse after 5 seconds of idleness
isavailable unclutter && unclutter -b

# Notification daemon
isavailable dunst && dunst &

# Notify low battery
isavailable i3-battery-popup && i3-battery-popup -n -i /usr/share/icons/Adwaita/32x32/legacy/battery-low-symbolic.symbolic.png &

# Reacts to device connection/disconnection events; see ~/.config/xplugrc
isavailable xplugd && xplugd &

# Simple X hotkey daemon
isavailable sxhkd && sxhkd &

# Clipboard manager
isavailable greenclip && greenclip daemon &

# Removes blue light from screen depending on sun elevation
# Hack taken from https://wiki.archlinux.org/title/Redshift#Automatic_location_based_on_GPS to bypass the whole geoclue2 service headache
isavailable redshift-gtk && redshift-gtk -l $(curl -s "https://location.services.mozilla.com/v1/geolocate?key=geoclue" | jq '.location.lat, .location.lng' | tr '\n' ':' | sed 's/:$//') &

# Automatically lock and suspend computer after X minutes of idleness
if [ -f $HOME/.bin/idlehook ]; then
    $HOME/.bin/idlehook &
fi

if [ -f $HOME/.bin/custom_keyboard_layout ]; then
    $HOME/.bin/custom_keyboard_layout us &
fi

# Start window manager
exec i3 > /tmp/i3.log 2>&1
